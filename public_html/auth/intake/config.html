<!-- No config needed -->
<?php
    // set to defaults if undefined
    if (!isset($config->recaptcha)) {
        $config->recaptcha = false;
    }

    $yesno = array( get_string('no'), get_string('yes') );

// Proccess messages
if ($result) {
   if ($result[0]) {
       // Positive process end
       $class = 'green';
   } else {
       // Negative
       $class = 'red';
   }
   ?>
<div class="<?php echo $class; ?>"><?php print_string('auth_intake_' . $result[1], 'auth_intake'); ?></div>
<?php
}
// EOF process messages
?>
<a href="/admin/auth_config.php?auth=intake&action=new" class="new_voucher_a"><?php print_string('auth_intake_new_voucher', 'auth_intake'); ?></a>
<h3 class="main"><?php print_string('auth_intake_vouchers_label', 'auth_intake'); ?></h3>
<table class="auth_intake_voucher" cellspacing="0" cellpadding="0" border="1" width="100%">
    <tr>
        <th><?php print_string('auth_intake_vouchercode', 'auth_intake'); ?></th>
        <th><?php print_string('auth_intake_vouchers_count', 'auth_intake'); ?></th>
        <th><?php print_string('auth_intake_vouchers_used', 'auth_intake'); ?></th>
        <th><?php print_string('auth_intake_voucher_courses', 'auth_intake'); ?></th>
        <th><?php print_string('auth_intake_voucher_groups', 'auth_intake'); ?></th>
        <th>&nbsp;</th>
    </tr>
    <?php
   foreach ($vouchers as $voucher) {
?>
    <tr>
        <td class="auth_intake_voucher_code"><?php p($voucher->code); ?></td>
        <td class="auth_intake_voucher_count" id="<?php p($voucher->code); ?>_count"><?php p($voucher->count); ?></td>
        <td class="auth_intake_voucher_used"> <?php p($voucher->used); ?></td>
        <td class="auth_intake_voucher_courses"><?php
      for ($i=0; $i<count($voucher->courses); $i++) {
            print $voucher->courses[$i]->fullname;
            if ($i+1 < count($voucher->courses)) {
            print ', ';
            }
            }
            ?></td>
        <td class="auth_intake_voucher_groups"><?php
      for ($i=0; $i<count($voucher->groups); $i++) {
            print $voucher->groups[$i]->fullname;
            if ($i+1 < count($voucher->groups)) {
            print ', ';
            }
            }
            ?></td>
        <td class="auth_intake_voucher_actions"><a href="/admin/auth_config.php?auth=intake&action=edit&code=<?php p($voucher->code); ?>"><?php print_string('auth_intake_edit_voucher', 'auth_intake'); ?></a> |
            <a href="javascript:void(0);" onclick="delete_voucher_form('<?php p($voucher->code); ?>');"><?php print_string('auth_intake_delete_voucher', 'auth_intake'); ?></a>
        </td>
    </tr>
    <?php
   }
?>
</table>
<div id="delete_voucher">
    <b><?php print_string('auth_intake_delete_voucher', 'auth_intake'); ?></b><br />
    <p><?php print_string('auth_intake_delete_voucher_confirmation', 'auth_intake'); ?></p>
    <input type="hidden" name="delete_voucher" value="0" id="delete_voucher_switch" />
    <input type="button" onclick="submit_form();" value="<?php print_string('auth_intake_delete_voucher_submit', 'auth_intake'); ?>" />
    <a href="javascript:void(0);" onclick="cancel_delete_voucher();"><?php print_string('auth_intake_cancel', 'auth_intake'); ?></a>

</div>

<table cellspacing="0" cellpadding="5" border="0">
<tr>
   <td colspan="3">
        <h2 class="main"><?php print_string('auth_intakesettings', 'auth_intake') ?> </h2>
   </td>
</tr>
<tr>
    <td align="right"><label for="menurecaptcha"><?php print_string('auth_intakerecaptcha_key', 'auth_intake') ?></label></td>
    <td><?php
        //global $OUTPUT;
        echo html_writer::select($yesno, 'recaptcha', $config->recaptcha, false);
        ?></td>
    <td><?php print_string('auth_intakerecaptcha', 'auth_intake') ?></td>
</tr>
<?php

print_auth_lock_options($this->authtype, $user_fields, get_string('auth_fieldlocks_help', 'auth'), false, false);

?>
</table>
<style>
    .new_voucher_a {
        float: right;
        font-weight: bold;
    }
    #new_voucher, #edit_voucher, #delete_voucher {
        display: none;
    }
    #delete_voucher {
        position: fixed;
        top: 200px;
        left: 50%;
        width: 300px;
        background: #FFF;
        margin-left: -150px;
        padding: 10px;
        border: 1px solid grey;


        -moz-box-shadow: 4px 4px 5px #888;
        -webkit-box-shadow: 4px 4px 5px #888;
        box-shadow: 4px 4px 5px #888;

        -moz-border-radius: 15px;
        border-radius: 15px;
    }
    #delete_voucher_id {
        font-weight: bold;
    }
</style>
<script type="text/javascript">
    function show_block(id) {
        document.getElementById(id).style.display = 'block';
        document.getElementById(id + '_switch').value = '1';
    }
    function hide_block(id) {
        document.getElementById(id + '_switch').value = '0';
        document.getElementById(id).style.display = 'none';
    }
    function hide_all_forms() {
        hide_block('delete_voucher');
    }

    function submit_form() {
        document.getElementById('authmenu').submit();
    }

    function delete_voucher_form(code) {
        hide_all_forms();
        show_block('delete_voucher');

        document.getElementById('delete_voucher_id').innerHTML = code;
        document.getElementById('delete_voucher_switch').value = code;
    }
    function cancel_delete_voucher() {
        hide_block('delete_voucher');
    }

</script>